.div
  .col-md-12.table-responsive
    %table.table.table-hover
      %thead
        %tr
          %th Ticket
          %th Quantity
          %th Price
          %th Total
      %tbody
      - @unpaid_ticket_purchases.each do |ticket|
        %tr
          %td
            = ticket.title
          %td
            = ticket.quantity
          %td
            = humanized_money_with_symbol ticket.adjusted_price
          %td
            = humanized_money_with_symbol ticket.quantity * ticket.adjusted_price
-if !Rails.configuration.use_braintree
  = form_tag conference_payments_path do
    - if @total_amount_to_pay.cents > 0
      %script.stripe-button{ src: "https://checkout.stripe.com/checkout.js",
            data: { amount: @total_amount_to_pay.cents, label: "Pay #{humanized_money_with_symbol @total_amount_to_pay}",
              email: current_user.email, currency: @total_amount_to_pay.currency, name: ENV['OSEM_NAME'] || 'OSEM',
              description: "book your tickets", key: Rails.application.secrets.stripe_publishable_key, locale: "auto"}}
    - else
      .pull-right
        = button_tag(type: 'submit', class: 'btn btn-success btn-lg') do
          Confirm

  = link_to 'Edit Purchase', conference_tickets_path(@conference.short_title), class: 'btn btn-default'
-if Rails.configuration.use_braintree
  %body
    %script{:src => "https://js.braintreegateway.com/web/dropin/1.4.0/js/dropin.min.js"}
    %input{id:'nonce',type:'hidden'}
    #dropin-container
    =form_tag(conference_payments_path, method: :post,id: "payment-form")
    %button{id:'submit-button' ,class:'stripe-button-el',display:'none'} Pay #{humanized_money_with_symbol @total_amount_to_pay}

  :javascript
    var form = document.querySelector('#payment-form');
    var client_token = 'sandbox_ws4v4q3x_k6p7dds39rgwdw9g';
    braintree.dropin.create({
      authorization: client_token,
      container: '#dropin-container',
      paypal: {
        flow: 'vault'
      }
    }, function (createErr, instance) {
      form.addEventListener('submit', function (event) {
        event.preventDefault();
        instance.requestPaymentMethod(function (err, payload) {
          if (err) {
            console.log('Error', err);
            return;
          }
          // Add the nonce to the form and submit
          document.querySelector('#nonce').value = payload.nonce;
          form.submit();
        });
      });
    });
    var checkout = new Demo({
      formID: 'payment-form'
    });